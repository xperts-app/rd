<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Select Chapter</title>
    <style>
        body { font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif; background-color: #f4f7f6; color: #333; margin: 0; padding: 20px; }
        .container { max-width: 800px; margin: auto; background: white; padding: 25px; border-radius: 8px; box-shadow: 0 2px 10px rgba(0,0,0,0.1); }
        h1 { color: #0056b3; }
        #chapterList { list-style-type: none; padding: 0; }
        #chapterList li { margin-bottom: 10px; }
        #chapterList a {
            display: block; text-decoration: none; background-color: #007bff; color: white; padding: 15px; border-radius: 5px; transition: background-color 0.3s;
        }
        #chapterList a:hover { background-color: #0056b3; }
        .loader, .message { text-align: center; font-size: 1.2em; color: #555; margin-top: 30px; }
    </style>
</head>
<body>

    <div class="container">
        <h1 id="pageTitle">Select a Chapter to Practice</h1>
        <div id="loader" class="loader">Loading chapters...</div>
        <ul id="chapterList"></ul>
        <div id="message" class="message"></div>
    </div>

    <!-- Firebase SDKs -->
    <script src="https://www.gstatic.com/firebasejs/8.6.1/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.6.1/firebase-firestore.js"></script>

    <script>
        // --- FIREBASE CONFIG ---
        const firebaseConfig = {
          apiKey: "AIzaSyBrdCOyTrQ_uU4jID8hWzCQzaXilhAcGcs",
          authDomain: "custom-practices.firebaseapp.com",
          projectId: "custom-practices",
          storageBucket: "custom-practices.firebasestorage.app",
          messagingSenderId: "636700937539",
          appId: "1:636700937539:web:d6ec9d88453e15481d33f6",
          measurementId: "G-JL58DMTZ0W"
        };
        firebase.initializeApp(firebaseConfig);
        const db = firebase.firestore();

        // --- DOM ELEMENTS ---
        const pageTitle = document.getElementById('pageTitle');
        const loader = document.getElementById('loader');
        const chapterList = document.getElementById('chapterList');
        const messageDiv = document.getElementById('message');

        // --- MAIN LOGIC ---
        document.addEventListener('DOMContentLoaded', () => {
            const urlParams = new URLSearchParams(window.location.search);
            const className = urlParams.get('class');
            const subjectName = urlParams.get('subject');

            if (!className || !subjectName) {
                displayMessage("No class or subject specified. Please select them from the main page. Example URL: 2.html?class=10&subject=MATH");
                loader.style.display = 'none';
                return;
            }
            
            pageTitle.textContent = `Chapters for ${className} - ${subjectName}`;
            fetchAndDisplayChapters(className, subjectName);
        });

        async function fetchAndDisplayChapters(className, subjectName) {
            try {
                const snapshot = await db.collection('questions')
                    .where('class', '==', className)
                    .where('subject', '==', subjectName)
                    .get();

                const chapters = new Set();
                snapshot.forEach(doc => {
                    chapters.add(doc.data().chapter);
                });
                
                loader.style.display = 'none';

                if (chapters.size === 0) {
                    displayMessage(`No chapters found for ${className} - ${subjectName}. The admin needs to add questions for this category.`);
                    return;
                }

                chapters.forEach(chapter => {
                    const li = document.createElement('li');
                    const a = document.createElement('a');
                    const encodedChapter = encodeURIComponent(chapter);
                    const encodedClass = encodeURIComponent(className);
                    const encodedSubject = encodeURIComponent(subjectName);
                    
                    a.href = `3.html?class=${encodedClass}&subject=${encodedSubject}&chapter=${encodedChapter}`;
                    a.textContent = chapter;
                    
                    li.appendChild(a);
                    chapterList.appendChild(li);
                });

            } catch (error) {
                console.error("Error fetching chapters: ", error);
                displayMessage("An error occurred while fetching chapters. Please try again later.");
                loader.style.display = 'none';
            }
        }

        function displayMessage(msg) {
            messageDiv.textContent = msg;
        }

    </script>

</body>
</html>
